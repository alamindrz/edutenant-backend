<!-- templates/students/academic_term_detail.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ term.name }} - {{ school.name }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">{{ term.name }}</h1>
            <p class="text-muted">{{ term.academic_year }} â€¢ {{ term.get_term_display }}</p>
        </div>
        <div class="btn-group">
            <a href="{% url 'students:academic_terms' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Terms
            </a>
            {% if term.status == 'active' %}
            <a href="{% url 'students:academic_term_suspend' term.id %}" class="btn btn-warning">
                <i class="fas fa-pause me-2"></i>Suspend
            </a>
            {% elif term.status == 'suspended' %}
            <a href="{% url 'students:academic_term_resume' term.id %}" class="btn btn-success">
                <i class="fas fa-play me-2"></i>Resume
            </a>
            {% endif %}
            {% if term.status != 'closed' %}
            <a href="{% url 'students:academic_term_close' term.id %}" class="btn btn-secondary">
                <i class="fas fa-stop me-2"></i>Close
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Term Overview Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <div class="h2 text-primary mb-1">{{ term.planned_weeks }}</div>
                    <small class="text-muted">Planned Weeks</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <div class="h2 text-success mb-1">{{ term.total_working_days }}</div>
                    <small class="text-muted">Working Days</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <div class="h2 text-info mb-1">{{ attendance_stats.total_records|default:0 }}</div>
                    <small class="text-muted">Attendance Records</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <div class="h2 text-{% if term.is_currently_active %}success{% else %}secondary{% endif %} mb-1">
                        {% if term.is_currently_active %}Active{% else %}Inactive{% endif %}
                    </div>
                    <small class="text-muted">Current Status</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Term Details -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Term Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr>
                                    <th width="40%">Academic Year:</th>
                                    <td>{{ term.academic_year }}</td>
                                </tr>
                                <tr>
                                    <th>Term:</th>
                                    <td>{{ term.get_term_display }}</td>
                                </tr>
                                <tr>
                                    <th>Start Date:</th>
                                    <td>{{ term.start_date|date:"F j, Y" }}</td>
                                </tr>
                                <tr>
                                    <th>End Date:</th>
                                    <td>{{ term.end_date|date:"F j, Y" }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr>
                                    <th width="40%">Status:</th>
                                    <td>
                                        <span class="badge bg-{% if term.status == 'active' %}success{% elif term.status == 'suspended' %}warning{% elif term.status == 'closed' %}secondary{% else %}info{% endif %}">
                                            {{ term.get_status_display }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Planned Weeks:</th>
                                    <td>{{ term.planned_weeks }} weeks</td>
                                </tr>
                                {% if term.actual_weeks %}
                                <tr>
                                    <th>Actual Weeks:</th>
                                    <td>{{ term.actual_weeks }} weeks</td>
                                </tr>
                                {% endif %}
                                {% if term.actual_end_date %}
                                <tr>
                                    <th>Actual End:</th>
                                    <td>{{ term.actual_end_date|date:"F j, Y" }}</td>
                                </tr>
                                {% endif %}
                            </table>
                        </div>
                    </div>

                    <!-- Breaks and Closures -->
                    {% if term.mid_term_break_start %}
                    <div class="mt-4">
                        <h6>Mid-Term Break</h6>
                        <p class="mb-0">
                            {{ term.mid_term_break_start|date:"M j" }} to {{ term.mid_term_break_end|date:"M j, Y" }}
                        </p>
                    </div>
                    {% endif %}

                    {% if term.closure_start %}
                    <div class="mt-4">
                        <h6 class="text-warning">Closure Period</h6>
                        <p class="mb-1">
                            {{ term.closure_start|date:"M j" }} to {{ term.closure_end|date:"M j, Y" }}
                        </p>
                        {% if term.closure_reason %}
                        <p class="text-muted small mb-0">Reason: {{ term.closure_reason }}</p>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'attendance:dashboard' %}?term={{ term.id }}" class="btn btn-outline-primary">
                            <i class="fas fa-chart-bar me-2"></i>View Attendance
                        </a>
                        <a href="{% url 'attendance:reports' %}?term={{ term.id }}" class="btn btn-outline-info">
                            <i class="fas fa-file-alt me-2"></i>Generate Reports
                        </a>
                    </div>
                </div>
            </div>

            <!-- School Days Info -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">School Days</h5>
                </div>
                <div class="card-body">
                    <p class="small text-muted">
                        Total working days: <strong>{{ term.total_working_days }}</strong><br>
                        <!-- FIXED: Proper if condition syntax -->
                        Today is {% if term.is_school_day  == today %}a{% else %}not a{% endif %} school day.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}