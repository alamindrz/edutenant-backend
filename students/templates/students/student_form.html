<!-- templates/students/student_form.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }} - {{ school.name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">{{ page_title }}</h5>
                </div>
                <div class="card-body">
                    <form method="post" id="studentForm">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                            {{ error }}
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Basic Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="border-bottom pb-2">Basic Information</h6>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.first_name.id_for_label }}" class="form-label">
                                        First Name *
                                    </label>
                                    {{ form.first_name }}
                                    {% if form.first_name.errors %}
                                    <div class="text-danger small">{{ form.first_name.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.last_name.id_for_label }}" class="form-label">
                                        Last Name *
                                    </label>
                                    {{ form.last_name }}
                                    {% if form.last_name.errors %}
                                    <div class="text-danger small">{{ form.last_name.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.gender.id_for_label }}" class="form-label">Gender *</label>
                                    {{ form.gender }}
                                    {% if form.gender.errors %}
                                    <div class="text-danger small">{{ form.gender.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">
                                        Date of Birth *
                                    </label>
                                    {{ form.date_of_birth }}
                                    {% if form.date_of_birth.errors %}
                                    <div class="text-danger small">{{ form.date_of_birth.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Academic Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="border-bottom pb-2">Academic Information</h6>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.education_level.id_for_label }}" class="form-label">
                                        Education Level *
                                    </label>
                                    {{ form.education_level }}
                                    {% if form.education_level.errors %}
                                    <div class="text-danger small">{{ form.education_level.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.class_group.id_for_label }}" class="form-label">
                                        Class Group
                                    </label>
                                    {{ form.class_group }}
                                    {% if form.class_group.errors %}
                                    <div class="text-danger small">{{ form.class_group.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Parent Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="border-bottom pb-2">Parent/Guardian Information</h6>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="{{ form.parent.id_for_label }}" class="form-label">
                                        Parent/Guardian *
                                    </label>
                                    {{ form.parent }}
                                    {% if form.parent.errors %}
                                    <div class="text-danger small">{{ form.parent.errors }}</div>
                                    {% endif %}
                                    <div class="form-text">
                                        Can't find the parent? <a href="{% url 'students:parent_create' %}">Add new parent</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Medical Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="border-bottom pb-2">Medical Information</h6>
                            </div>
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="{{ form.medical_conditions.id_for_label }}" class="form-label">
                                        Medical Conditions
                                    </label>
                                    {{ form.medical_conditions }}
                                    {% if form.medical_conditions.errors %}
                                    <div class="text-danger small">{{ form.medical_conditions.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.allergies.id_for_label }}" class="form-label">
                                        Allergies
                                    </label>
                                    {{ form.allergies }}
                                    {% if form.allergies.errors %}
                                    <div class="text-danger small">{{ form.allergies.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.emergency_contact.id_for_label }}" class="form-label">
                                        Emergency Contact
                                    </label>
                                    {{ form.emergency_contact }}
                                    {% if form.emergency_contact.errors %}
                                    <div class="text-danger small">{{ form.emergency_contact.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a href="{% url 'students:student_list' %}" class="btn btn-outline-secondary">
                                        <i class="fas fa-arrow-left"></i> Back to List
                                    </a>
                                    <div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i> 
                                            {% if student %}Update Student{% else %}Create Student{% endif %}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Dynamic class group loading based on education level
document.getElementById('id_education_level').addEventListener('change', function() {
    const levelId = this.value;
    const classGroupSelect = document.getElementById('id_class_group');
    
    if (levelId) {
        fetch(`{% url 'students:get_class_groups_for_level' 0 %}`.replace('0', levelId))
            .then(response => response.json())
            .then(data => {
                classGroupSelect.innerHTML = '<option value="">---------</option>';
                data.forEach(classGroup => {
                    const option = document.createElement('option');
                    option.value = classGroup.id;
                    option.textContent = classGroup.name;
                    classGroupSelect.appendChild(option);
                });
            });
    }
});
</script>
{% endblock %}