{% extends "base.html" %}
{% load static %}

{% block title %}Application Status - {{ school.name }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Status Header -->
            <div class="text-center mb-5">
                <div class="status-icon mb-4">
                    {% if application.status == 'submitted' %}
                    <i class="bi bi-clock-history text-warning" style="font-size: 4rem;"></i>
                    {% elif application.status == 'under_review' %}
                    <i class="bi bi-search text-info" style="font-size: 4rem;"></i>
                    {% elif application.status == 'accepted' %}
                    <i class="bi bi-check-circle text-success" style="font-size: 4rem;"></i>
                    {% elif application.status == 'rejected' %}
                    <i class="bi bi-x-circle text-danger" style="font-size: 4rem;"></i>
                    {% else %}
                    <i class="bi bi-file-text text-primary" style="font-size: 4rem;"></i>
                    {% endif %}
                </div>
                
                <h1 class="display-5 fw-bold">
                    {% if application.status == 'submitted' %}Application Submitted
                    {% elif application.status == 'under_review' %}Under Review
                    {% elif application.status == 'accepted' %}Application Accepted!
                    {% elif application.status == 'rejected' %}Application Not Accepted
                    {% else %}Application Status{% endif %}
                </h1>
                <p class="lead text-muted">Check your application progress for {{ school.name }}</p>
            </div>

            <!-- Application Details Card -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-file-text me-2"></i>Application Details
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Application Information</h6>
                            <p><strong>Application Number:</strong><br>
                               <span class="text-primary">{{ application.application_number }}</span></p>
                            <p><strong>Student Name:</strong><br>
                               {{ application.student.full_name }}</p>
                            <p><strong>Applied Class:</strong><br>
                               {{ application.applied_class.name }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6>Status & Timeline</h6>
                            <p><strong>Current Status:</strong><br>
                               <span class="badge 
                                   {% if application.status == 'submitted' %}bg-warning
                                   {% elif application.status == 'under_review' %}bg-info
                                   {% elif application.status == 'accepted' %}bg-success
                                   {% elif application.status == 'rejected' %}bg-danger
                                   {% else %}bg-secondary{% endif %}">
                                   {{ application.get_status_display }}
                               </span>
                            </p>
                            <p><strong>Submitted:</strong><br>
                               {{ application.submitted_at|date:"F j, Y" }}</p>
                            <p><strong>Last Updated:</strong><br>
                               {{ application.updated_at|date:"F j, Y" }}</p>
                        </div>
                    </div>

                    <!-- Admission Offer (if accepted) -->
                    {% if application.admission %}
                    <div class="mt-4 p-3 bg-success bg-opacity-10 border border-success rounded">
                        <h6 class="text-success">
                            <i class="bi bi-award me-2"></i>Admission Offer Available!
                        </h6>
                        <p class="mb-2">Admission Number: <strong>{{ application.admission.admission_number }}</strong></p>
                        <p class="mb-0">Offer expires: {{ application.admission.offer_expires|date:"F j, Y" }}</p>
                    </div>
                    {% endif %}

                    <!-- Status Timeline -->
                    <div class="mt-4">
                        <h6>Application Timeline</h6>
                        <div class="timeline">
                            <div class="timeline-item {% if application.status == 'submitted' %}active{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <strong>Application Submitted</strong>
                                    <small class="text-muted">{{ application.submitted_at|date:"M j, Y" }}</small>
                                </div>
                            </div>
                            <div class="timeline-item {% if application.status == 'under_review' %}active{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <strong>Under Review</strong>
                                    <small class="text-muted">Being processed by admissions team</small>
                                </div>
                            </div>
                            <div class="timeline-item {% if application.status == 'accepted' or application.status == 'rejected' %}active{% endif %}">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <strong>Decision Made</strong>
                                    <small class="text-muted">
                                        {% if application.status == 'accepted' %}Application accepted
                                        {% elif application.status == 'rejected' %}Application not accepted
                                        {% else %}Pending decision{% endif %}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Next Steps -->
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-info-circle me-2"></i>Next Steps
                    </h5>
                </div>
                <div class="card-body">
                    {% if application.status == 'submitted' %}
                    <p>Your application has been received and is in the queue for review.</p>
                    <ul>
                        <li>We'll review your application within 3-5 business days</li>
                        <li>You'll receive an email when there's an update</li>
                        <li>Check back here for status updates</li>
                    </ul>
                    {% elif application.status == 'under_review' %}
                    <p>Your application is currently being reviewed by our admissions team.</p>
                    <ul>
                        <li>This process typically takes 5-7 business days</li>
                        <li>We may contact you if additional information is needed</li>
                        <li>You'll be notified immediately once a decision is made</li>
                    </ul>
                    {% elif application.status == 'accepted' %}
                    <p>Congratulations! Your application has been accepted.</p>
                    <ul>
                        <li>Check your email for the official admission letter</li>
                        <li>Complete any required acceptance procedures</li>
                        <li>Contact the school if you have any questions</li>
                    </ul>
                    {% elif application.status == 'rejected' %}
                    <p>Thank you for your interest in {{ school.name }}.</p>
                    <ul>
                        <li>We appreciate you taking the time to apply</li>
                        <li>Consider applying for future academic sessions</li>
                        <li>Contact admissions for feedback on your application</li>
                    </ul>
                    {% endif %}

                    <div class="mt-3">
                        <strong>Need Help?</strong>
                        <p class="mb-0">
                            Contact the admissions office at 
                            <a href="mailto:{{ school.contact_email }}">{{ school.contact_email }}</a>
                            or call {{ school.phone_number|default:"the school office" }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Share Link -->
            <div class="text-center mt-4">
                <div class="alert alert-info">
                    <h6><i class="bi bi-share me-2"></i>Share Application Status</h6>
                    <p class="mb-2">Share this link with family members to check application status:</p>
                    <div class="input-group">
                        <input type="text" class="form-control" value="{{ request.build_absolute_uri }}" readonly>
                        <button class="btn btn-outline-primary" onclick="copyToClipboard(this)">
                            <i class="bi bi-clipboard me-1"></i>Copy
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.timeline {
    position: relative;
    padding-left: 2rem;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 0.75rem;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--bs-border-color);
}

.timeline-item {
    position: relative;
    margin-bottom: 1.5rem;
}

.timeline-marker {
    position: absolute;
    left: -2rem;
    top: 0.25rem;
    width: 1rem;
    height: 1rem;
    border-radius: 50%;
    background: var(--bs-secondary);
    border: 2px solid white;
}

.timeline-item.active .timeline-marker {
    background: var(--bs-primary);
    box-shadow: 0 0 0 3px rgba(var(--bs-primary-rgb), 0.2);
}

.timeline-content {
    padding-left: 0.5rem;
}

.status-icon {
    animation: bounceIn 1s ease-in-out;
}

@keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); opacity: 1; }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function copyToClipboard(button) {
    const input = button.closest('.input-group').querySelector('input');
    input.select();
    document.execCommand('copy');
    
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="bi bi-check me-1"></i>Copied!';
    button.classList.remove('btn-outline-primary');
    button.classList.add('btn-success');
    
    setTimeout(() => {
        button.innerHTML = originalText;
        button.classList.remove('btn-success');
        button.classList.add('btn-outline-primary');
    }, 2000);
}
</script>
{% endblock %}