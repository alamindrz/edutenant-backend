<!-- templates/admissions/payment_redirect.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}Complete Payment - {{ school.name }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card">
                <div class="card-body text-center py-5">
                    <!-- Payment Header -->
                    <div class="mb-4">
                        <i class="fas fa-credit-card fa-4x text-primary mb-3"></i>
                        <h1 class="h3">Complete Payment</h1>
                        <p class="text-muted">Complete your application by paying the application fee</p>
                    </div>
                    
                    <!-- Payment Details -->
                    <div class="alert alert-primary text-start mb-4">
                        <div class="row">
                            <div class="col-6">
                                <h6 class="mb-2">Application Fee</h6>
                                <h3 class="text-primary">â‚¦{{ amount|floatformat:"2" }}</h3>
                            </div>
                            <div class="col-6 text-end">
                                <h6 class="mb-2">Reference</h6>
                                <code class="text-primary">{{ reference }}</code>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Application Summary -->
                    <div class="text-start mb-4">
                        <h6 class="text-muted mb-3">Application Summary</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between px-0">
                                <span>Form</span>
                                <strong>{{ form.name }}</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between px-0">
                                <span>School</span>
                                <strong>{{ school.name }}</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between px-0">
                                <span>Academic Session</span>
                                <strong>{{ form.academic_session }}</strong>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Payment Instructions -->
                    <div class="alert alert-info text-start mb-4">
                        <h6 class="alert-heading">
                            <i class="fas fa-info-circle me-2"></i>Payment Instructions
                        </h6>
                        <ol class="mb-0">
                            <li>Click the "Proceed to Payment" button below</li>
                            <li>You will be redirected to a secure payment page</li>
                            <li>Complete your payment using your preferred method</li>
                            <li>You will be redirected back to the application success page</li>
                        </ol>
                    </div>
                    
                    <!-- Payment Methods -->
                    <div class="mb-4">
                        <h6 class="text-muted mb-3">Accepted Payment Methods</h6>
                        <div class="d-flex justify-content-center gap-3">
                            <i class="fab fa-cc-mastercard fa-2x text-primary"></i>
                            <i class="fab fa-cc-visa fa-2x text-primary"></i>
                            <i class="fab fa-cc-amex fa-2x text-primary"></i>
                            <i class="fab fa-cc-paypal fa-2x text-primary"></i>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-grid gap-2">
                        <a href="{{ payment_url }}" class="btn btn-primary btn-lg" id="payment-button">
                            <i class="fas fa-lock me-2"></i>Proceed to Secure Payment
                        </a>
                        
                        <div class="d-flex gap-2">
                            <a href="{% url 'admissions:apply' form.slug %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Application
                            </a>
                            
                            <a href="{% url 'admissions:payment_cancel' %}" class="btn btn-outline-danger">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>
                    </div>
                    
                    <!-- Security Notice -->
                    <div class="mt-4 pt-3 border-top">
                        <p class="small text-muted mb-0">
                            <i class="fas fa-shield-alt me-1"></i>
                            Your payment is processed securely. We do not store your card details.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Auto-redirect after 10 seconds
let countdown = 10;
const countdownElement = document.createElement('p');
countdownElement.className = 'text-muted small mt-2';
document.querySelector('#payment-button').after(countdownElement);

function updateCountdown() {
    if (countdown > 0) {
        countdownElement.textContent = `Auto-redirecting in ${countdown} seconds...`;
        countdown--;
        setTimeout(updateCountdown, 1000);
    } else {
        window.location.href = "{{ payment_url }}";
    }
}

// Start countdown
updateCountdown();

// Payment button click tracking
document.getElementById('payment-button').addEventListener('click', function() {
    // You can add analytics tracking here
    console.log('Payment initiated for reference: {{ reference }}');
});
</script>

<style>
.list-group-item {
    background: transparent;
    border-color: rgba(0, 0, 0, 0.125);
}

.btn-lg {
    padding: 0.75rem 1.5rem;
    font-size: 1.1rem;
}

.fa-cc-mastercard, .fa-cc-visa, .fa-cc-amex, .fa-cc-paypal {
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

.fa-cc-mastercard:hover, .fa-cc-visa:hover, .fa-cc-amex:hover, .fa-cc-paypal:hover {
    opacity: 1;
}
</style>
{% endblock %}