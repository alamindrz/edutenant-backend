<!-- templates/users/partials/role_table.html -->
<div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th>Role Name</th>
                <th>Category</th>
                <th>Description</th>
                <th>Assignments</th>
                <th>Type</th>
                <th>Status</th>
                <th width="120">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for role in roles %}
            <tr>
                <td>
                    <strong>{{ role.name }}</strong>
                    {% if role.is_system_role %}
                    <br>
                    <small class="text-primary">System Role</small>
                    {% endif %}
                </td>
                <td>
                    <span class="badge bg-{% if role.category == 'academic' %}success{% elif role.category == 'administration' %}info{% elif role.category == 'student' %}warning{% elif role.category == 'parent' %}secondary{% else %}dark{% endif %}">
                        {{ role.get_category_display }}
                    </span>
                </td>
                <td>
                    {{ role.description|default:"No description"|truncatewords:10 }}
                </td>
                <td>
                    <span class="fw-bold">{{ role_stats|get_item:role.id.total_assignments|default:"0" }}</span>
                    <small class="text-muted d-block">assignments</small>
                </td>
                <td>
                    {% if role.is_system_role %}
                    <span class="badge bg-primary">System</span>
                    {% else %}
                    <span class="badge bg-success">Custom</span>
                    {% endif %}
                </td>
                <td>
                    {% if role.is_active %}
                    <span class="badge bg-success">Active</span>
                    {% else %}
                    <span class="badge bg-secondary">Inactive</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <a href="{% url 'users:role_detail' role.id %}" class="btn btn-outline-primary" title="View Details">
                            <i class="fas fa-eye"></i>
                        </a>
                        {% if not role.is_system_role %}
                        <a href="{% url 'users:role_edit' role.id %}" class="btn btn-outline-secondary" title="Edit Role">
                            <i class="fas fa-edit"></i>
                        </a>
                        {% else %}
                        <button class="btn btn-outline-secondary" disabled title="System roles cannot be edited">
                            <i class="fas fa-edit"></i>
                        </button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center py-4">
                    <div class="text-muted">
                        <i class="fas fa-user-shield fa-2x d-block mb-2"></i>
                        No roles found
                        {% if search_query or category_filter %}
                        <br><small>Try adjusting your filters</small>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if roles.has_other_pages %}
    <div class="card-footer">
        <nav aria-label="Role pagination">
            <ul class="pagination justify-content-center mb-0">
                {% if roles.has_previous %}
                <li class="page-item">
                    <a class="page-link" 
                       hx-get="{% url 'users:role_table_partial' %}"
                       hx-target="#role-table"
                       hx-vals='{"page": "{{ roles.previous_page_number }}", "search": "{{ search_query }}", "category": "{{ category_filter }}"}'
                       href="?page={{ roles.previous_page_number }}">&laquo;</a>
                </li>
                {% endif %}
                
                {% for i in roles.paginator.page_range %}
                <li class="page-item {% if roles.number == i %}active{% endif %}">
                    <a class="page-link" 
                       hx-get="{% url 'users:role_table_partial' %}"
                       hx-target="#role-table"
                       hx-vals='{"page": "{{ i }}", "search": "{{ search_query }}", "category": "{{ category_filter }}"}'
                       href="?page={{ i }}">{{ i }}</a>
                </li>
                {% endfor %}
                
                {% if roles.has_next %}
                <li class="page-item">
                    <a class="page-link" 
                       hx-get="{% url 'users:role_table_partial' %}"
                       hx-target="#role-table"
                       hx-vals='{"page": "{{ roles.next_page_number }}", "search": "{{ search_query }}", "category": "{{ category_filter }}"}'
                       href="?page={{ roles.next_page_number }}">&raquo;</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
    {% endif %}
</div>

<script>
// Simple dictionary access helper
function getItem(dict, key) {
    return dict ? dict[key] : null;
}
</script>